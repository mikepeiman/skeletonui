import{s as Y,D as x,E as $,g as w,c as D,h as C,i as U,d as V,M as B,k as S,S as Z,T as ee,B as te,l as v,m as y,F as ne}from"../chunks/scheduler.4e08fc29.js";import{S as ie,i as se,d as R,v as ae,j as oe,k as le,m as ce,b as ue,t as fe,l as re,e as b,g as k,a as j,n as p,o as O,s as q}from"../chunks/index.c26ee3ff.js";import{g as me}from"../chunks/globals.7f7f1b26.js";import{A as K}from"../chunks/AuthCheck.2accb33c.js";import{d as E,a as L,b as I,g as G,w as H}from"../chunks/firebase.1ddb5b14.js";const{console:de}=me,A="C:/Users/mikep/Desktop/WebDev/skeleton-ui/src/routes/login/username/+page.svelte";function N(n){let e,t,c,i;const o={c:function(){e=w("p"),t=v("Checking availability of @"),c=v(n[0]),i=v("..."),this.h()},l:function(l){e=C(l,"P",{class:!0});var m=U(e);t=y(m,"Checking availability of @"),c=y(m,n[0]),i=y(m,"..."),m.forEach(b),this.h()},h:function(){k(e,"class","text-secondary"),S(e,A,73,4,1844)},m:function(l,m){j(l,e,m),p(e,t),p(e,c),p(e,i)},p:function(l,m){m&1&&q(c,l[0])},d:function(l){l&&b(e)}};return R("SvelteRegisterBlock",{block:o,id:N.name,type:"if",source:"(63:3) {#if loading}",ctx:n}),o}function z(n){let e,t="must be 3-16 characters long, alphanumeric only";const c={c:function(){e=w("p"),e.textContent=t,this.h()},l:function(o){e=C(o,"P",{class:!0,"data-svelte-h":!0}),ne(e)!=="svelte-1cznyih"&&(e.textContent=t),this.h()},h:function(){k(e,"class","text-error text-sm"),S(e,A,77,4,1963)},m:function(o,a){j(o,e,a)},d:function(o){o&&b(e)}};return R("SvelteRegisterBlock",{block:c,id:z.name,type:"if",source:"(67:3) {#if !isValid && isTouched}",ctx:n}),c}function F(n){let e,t,c,i;const o={c:function(){e=w("p"),t=v("@"),c=v(n[0]),i=v(" is not available"),this.h()},l:function(l){e=C(l,"P",{class:!0});var m=U(e);t=y(m,"@"),c=y(m,n[0]),i=y(m," is not available"),m.forEach(b),this.h()},h:function(){k(e,"class","text-warning text-sm"),S(e,A,81,4,2108)},m:function(l,m){j(l,e,m),p(e,t),p(e,c),p(e,i)},p:function(l,m){m&1&&q(c,l[0])},d:function(l){l&&b(e)}};return R("SvelteRegisterBlock",{block:o,id:F.name,type:"if",source:"(71:3) {#if isValid && !isAvailable && !loading}",ctx:n}),o}function M(n){let e,t,c;const i={c:function(){e=w("button"),t=v("Confirm username @"),c=v(n[0]),this.h()},l:function(a){e=C(a,"BUTTON",{class:!0});var l=U(e);t=y(l,"Confirm username @"),c=y(l,n[0]),l.forEach(b),this.h()},h:function(){k(e,"class","btn btn-success bg-green-400"),S(e,A,87,4,2225)},m:function(a,l){j(a,e,l),p(e,t),p(e,c)},p:function(a,l){l&1&&q(c,a[0])},d:function(a){a&&b(e)}};return R("SvelteRegisterBlock",{block:i,id:M.name,type:"if",source:"(77:3) {#if isAvailable}",ctx:n}),i}function Q(n){let e,t,c,i,o,a,l,m,h,f=n[1]&&N(n),r=!n[3]&&n[5]&&z(n),d=n[3]&&!n[2]&&!n[1]&&F(n),_=n[2]&&M(n);const P={c:function(){e=w("form"),t=w("input"),c=D(),i=w("div"),f&&f.c(),o=D(),r&&r.c(),a=D(),d&&d.c(),l=D(),_&&_.c(),this.h()},l:function(u){e=C(u,"FORM",{class:!0});var s=U(e);t=C(s,"INPUT",{type:!0,placeholder:!0,class:!0}),c=V(s),i=C(s,"DIV",{class:!0});var g=U(i);f&&f.l(g),o=V(g),r&&r.l(g),a=V(g),d&&d.l(g),l=V(g),_&&_.l(g),g.forEach(b),s.forEach(b),this.h()},h:function(){k(t,"type","text"),k(t,"placeholder","Username"),k(t,"class","input w-full s-2uxiIfS5eu3_"),B(t,"input-error",!n[3]&&n[5]),B(t,"input-warning",n[4]),B(t,"input-success",n[2]&&n[3]&&!n[1]),S(t,A,61,2,1497),k(i,"class","my-4 min-h-16 px-8 w-full"),S(i,A,71,2,1781),k(e,"class","w-2/5"),S(e,A,60,1,1430)},m:function(u,s){j(u,e,s),p(e,t),Z(t,n[0]),p(e,c),p(e,i),f&&f.m(i,null),p(i,o),r&&r.m(i,null),p(i,a),d&&d.m(i,null),p(i,l),_&&_.m(i,null),m||(h=[O(t,"input",n[8]),O(t,"input",n[6],!1,!1,!1,!1),O(e,"submit",ee(n[7]),!1,!0,!1,!1)],m=!0)},p:function(u,s){s&1&&t.value!==u[0]&&Z(t,u[0]),s&40&&B(t,"input-error",!u[3]&&u[5]),s&16&&B(t,"input-warning",u[4]),s&14&&B(t,"input-success",u[2]&&u[3]&&!u[1]),u[1]?f?f.p(u,s):(f=N(u),f.c(),f.m(i,o)):f&&(f.d(1),f=null),!u[3]&&u[5]?r||(r=z(u),r.c(),r.m(i,a)):r&&(r.d(1),r=null),u[3]&&!u[2]&&!u[1]?d?d.p(u,s):(d=F(u),d.c(),d.m(i,l)):d&&(d.d(1),d=null),u[2]?_?_.p(u,s):(_=M(u),_.c(),_.m(i,null)):_&&(_.d(1),_=null)},d:function(u){u&&b(e),f&&f.d(),r&&r.d(),d&&d.d(),_&&_.d(),m=!1,te(h)}};return R("SvelteRegisterBlock",{block:P,id:Q.name,type:"slot",source:"(50:0) <AuthCheck>",ctx:n}),P}function W(n){let e,t;e=new K({props:{$$slots:{default:[Q]},$$scope:{ctx:n}},$$inline:!0});const c={c:function(){oe(e.$$.fragment)},l:function(o){le(e.$$.fragment,o)},m:function(o,a){ce(e,o,a),t=!0},p:function(o,[a]){const l={};a&2111&&(l.$$scope={dirty:a,ctx:o}),e.$set(l)},i:function(o){t||(ue(e.$$.fragment,o),t=!0)},o:function(o){fe(e.$$.fragment,o),t=!1},d:function(o){re(e,o)}};return R("SvelteRegisterBlock",{block:c,id:W.name,type:"component",source:"",ctx:n}),c}const J=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function he(n,e,t){let c,i,o,a;x(L,"user"),$(n,L,s=>t(10,a=s));let{$$slots:l={},$$scope:m}=e;ae("Page",l,[]);let h="",f=!1,r=!1,d;async function _(){t(2,r=!1),clearTimeout(d),t(1,f=!0),d=setTimeout(async()=>{console.log("checking availability of",h);const s=I(E,"usernames",h),g=await G(s).then(X=>X.exists());t(2,r=!g),t(1,f=!1)},200)}async function P(){console.log("confirming username",h);const s=H(E);s.set(I(E,"usernames",h),{uid:a==null?void 0:a.uid}),s.set(I(E,"users",a.uid),{username:h,photoURL:(a==null?void 0:a.photoURL)??null,published:!0,bio:"I am the Walrus",links:[{title:"Test Link",url:"https://kung.foo",icon:"custom"}]}),await s.commit(),t(0,h=""),t(2,r=!1)}const T=[];Object.keys(e).forEach(s=>{!~T.indexOf(s)&&s.slice(0,2)!=="$$"&&s!=="slot"&&de.warn(`<Page> was created with unknown prop '${s}'`)});function u(){h=this.value,t(0,h)}return n.$capture_state=()=>({AuthCheck:K,db:E,user:L,doc:I,getDoc:G,writeBatch:H,username:h,loading:f,isAvailable:r,debounceTimer:d,checkAvailability:_,re:J,confirmUsername:P,isValid:c,isTaken:o,isTouched:i,$user:a}),n.$inject_state=s=>{"username"in s&&t(0,h=s.username),"loading"in s&&t(1,f=s.loading),"isAvailable"in s&&t(2,r=s.isAvailable),"debounceTimer"in s&&(d=s.debounceTimer),"isValid"in s&&t(3,c=s.isValid),"isTaken"in s&&t(4,o=s.isTaken),"isTouched"in s&&t(5,i=s.isTouched)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&1&&t(3,c=(h==null?void 0:h.length)>2&&h.length<16&&J.test(h)),n.$$.dirty&1&&t(5,i=h.length>0),n.$$.dirty&14&&t(4,o=c&&!r&&!f)},[h,f,r,c,o,i,_,P,u]}class ve extends ie{constructor(e){super(e),se(this,e,he,W,Y,{}),R("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:W.name})}}export{ve as component};
